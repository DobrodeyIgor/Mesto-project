(()=>{"use strict";var e=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.disabled=!1):(t.classList.add(n),t.disabled=!0)},t=function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))},n=function(e,n){return fetch(e,n).then(t)},o={baseUrl:"https://mesto.nomoreparties.co/v1/wbf-cohort-5",headers:{authorization:"a42e03f3-9db9-4d21-a03c-ed0890bb2c58","Content-Type":"application/json"}},r=function(){return n("".concat(o.baseUrl,"/cards"),{headers:o.headers}).then((function(e){return e}))},c=function(e){return n("".concat(o.baseUrl,"/cards/").concat(e),{headers:o.headers,method:"DELETE"})},u=function(e){return n("".concat(o.baseUrl,"/cards/likes/").concat(e),{headers:o.headers,method:"PUT"}).then((function(e){return e}))},a=function(e){return n("".concat(o.baseUrl,"/cards/likes/").concat(e),{headers:o.headers,method:"DELETE"}).then((function(e){return e}))};function i(e){"Escape"===e.code&&f()}function l(e){e.stopPropagation()}function s(e){e.classList.remove("popup_opened")}function d(e){e.classList.add("popup_opened");var t=e.querySelector(".popup__container");t.addEventListener("click",l),t.removeEventListener("click",l),e.addEventListener("click",f),e.removeEventListener("click",f),window.addEventListener("keyup",i),window.removeEventListener("keyup",i)}function f(){var e;(e=document.querySelectorAll(".popup_opened"),Array.from(e)).forEach((function(e){s(e)}))}var m=document.querySelector(".popup__figure"),p=m.querySelector(".popup__figure-image"),v=m.querySelector(".popup__figure-caption"),_=document.querySelector("#card");function y(e,t,n,o,i){var l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],f=_.content.cloneNode(!0).querySelector("div"),m=f.querySelector(".elements__item-title");m.title=e,m.textContent=e;var y=f.querySelector(".elements__image");y.alt=e,y.src=t,y.addEventListener("click",(function(){!function(e,t){v.textContent=e,p.alt=e,p.src=t}(e,t),d(n)}));var q=f.querySelector(".elements__favorite-counter");q.textContent=l.length;var L=f.querySelector(".elements__favorite-button"),E="elements__favorite-button_active";h(l,i)?S(L,E):b(L,E),L.addEventListener("click",(function(){return function(e,t,n,o,c){r().then((function(r){h(r.find((function(e){return e._id===c})).likes,o)?a(c).then((function(o){!function(e,t){e.textContent=t.likes.length}(t,o),b(e,n)})):u(c).then((function(o){!function(e,t){e.textContent=t.likes.length}(t,o),S(e,n)}))})).catch((function(e){console.log(e)}))}(L,q,E,i,o)}));var g=f.querySelector(".elements__remove-button");return s?g.addEventListener("click",(function(e){return function(e,t){e.stopPropagation(),c(t).then((function(t){t&&e.target.closest(".elements__item").remove()})).catch((function(e){console.log(e)}))}(e,o)})):g.classList.add("elements__remove-button_inactive"),f}function h(e,t){return-1!==e.findIndex((function(e){return e._id===t}))}function S(e,t){e.classList.add(t)}function b(e,t){e.classList.remove(t)}var q=document.querySelector(".popup[data-type=create]"),L=document.querySelector(".popup[data-type=edit]"),E=document.querySelector(".popup[data-type=img]"),g=document.querySelector(".popup[data-type=avatar]"),k=document.querySelector(".profile__name"),C=document.querySelector("input[name=user-name"),x=document.querySelector(".profile__status"),U=document.querySelector("input[name=user-status"),A=document.querySelector(".profile__image"),w=document.querySelector("input[name=avatar-link]"),P=document.querySelector(".elements"),T=[];n("".concat(o.baseUrl,"/users/me"),{headers:o.headers}).then((function(e){return e})).then((function(e){k.textContent=e.name,x.textContent=e.about,A.src=e.avatar,T[0]=e._id,r().then((function(t){t.forEach((function(t){var n=e._id===t.owner._id,o=y(t.name,t.link,E,t._id,e._id,t.likes,n);P.append(o)}))})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}));var D=document.querySelector(".profile__button_move_edit"),B=document.querySelector(".popup__exit-button[data-type=edit]"),N=document.querySelector(".profile__button_move_add"),O=document.querySelector(".popup__exit-button[data-type=create]"),j=document.querySelector(".popup__exit-button[data-type=img]"),J=document.querySelector(".profile__image-wrapper"),H=document.querySelector(".popup__exit-button[data-type=avatar]");D.addEventListener("click",(function(){d(L),C.value=k.textContent,U.value=x.textContent})),B.addEventListener("click",(function(){return s(L)})),N.addEventListener("click",(function(){return d(q)})),O.addEventListener("click",(function(){return s(q)})),j.addEventListener("click",(function(){return s(E)})),J.addEventListener("click",(function(){return d(g)})),H.addEventListener("click",(function(){return s(g)}));var z=document.querySelector("form[data-type=edit]");z.addEventListener("submit",(function(e){e.preventDefault(),te(I),function(e){return n("".concat(o.baseUrl,"/users/me"),{headers:o.headers,method:"PATCH",body:JSON.stringify(e)}).then((function(e){return e}))}({name:C.value,about:U.value}).then((function(e){k.textContent=e.name,x.textContent=e.about,s(L)})).catch((function(e){console.log(e)})).finally((function(){ne(I)}))}));var I=z.querySelector(".form__submit-button"),M=document.querySelector("input[name=place-name]"),F=document.querySelector("input[name=place-image]"),G=document.querySelector("form[data-type=create]");G.addEventListener("submit",(function(e){e.preventDefault(),te(K),function(e){return n("".concat(o.baseUrl,"/cards"),{headers:o.headers,method:"POST",body:JSON.stringify(e)}).then((function(e){return e}))}({name:M.value,link:F.value}).then((function(e){var t=y(e.name,e.link,E,e._id,T[0]);P.prepend(t),M.value="",F.value="",s(q)})).catch((function(e){console.log(e)})).finally((function(){ne(K)}))}));var K=G.querySelector(".form__submit-button"),Q=document.querySelector("form[data-type=avatar]");Q.addEventListener("submit",(function(e){e.preventDefault(),te(ee),function(e){return n("".concat(o.baseUrl,"/users/me/avatar"),{headers:o.headers,method:"PATCH",body:JSON.stringify(e)}).then((function(e){return e}))}({avatar:w.value}).then((function(e){A.src=w.value,s(g)})).catch((function(e){console.log(e)})).finally((function(){ne(ee)}))}));var R,V,W,X,Y,Z,$,ee=Q.querySelector(".form__submit-button");function te(e){e.disabled=!0,e.textContent="Сохранение...",e.classList.add("form__submit-button_inactive")}function ne(e){e.disabled=!1,e.textContent="Сохранить",e.classList.remove("form__submit-button_inactive")}V=(R={formSelector:".form",inputSelector:".form__text-field",submitButtonSelector:".form__submit-button",inactiveButtonClass:"form__submit-button_inactive",inputErrorClass:"form__text-field_type_error",errorClass:"form__text-field-error_active"}).formSelector,W=R.inputSelector,X=R.submitButtonSelector,Y=R.inactiveButtonClass,Z=R.inputErrorClass,$=R.errorClass,Array.from(document.querySelectorAll(V)).forEach((function(t){!function(t,n,o,r,c,u){var a=Array.from(t.querySelectorAll(n)),i=t.querySelector(o);e(a,i,r),a.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n,o){t.validity.valid?function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),r.classList.remove(o),r.textContent=""}(e,t,n,o):function(e,t,n,o,r){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),c.textContent=n,c.classList.add(r)}(e,t,t.validationMessage,n,o)}(t,n,c,u),e(a,i,r)}))}))}(t,W,X,Y,Z,$)}))})();