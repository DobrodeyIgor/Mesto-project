(()=>{"use strict";var e=function(e,n,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?function(e,t){e.classList.remove(t),e.disabled=!1}(n,o):t(n,o)};function t(e,t){e.classList.add(t),e.disabled=!0}var n=function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))},o=function(e,t){return fetch(e,t).then(n)},r={baseUrl:"https://mesto.nomoreparties.co/v1/wbf-cohort-5",headers:{authorization:"a42e03f3-9db9-4d21-a03c-ed0890bb2c58","Content-Type":"application/json"}},c=function(){return o("".concat(r.baseUrl,"/cards"),{headers:r.headers}).then((function(e){return e}))},u=function(e){return o("".concat(r.baseUrl,"/cards/").concat(e),{headers:r.headers,method:"DELETE"})},i=function(e){return o("".concat(r.baseUrl,"/cards/likes/").concat(e),{headers:r.headers,method:"PUT"}).then((function(e){return e}))},a=function(e){return o("".concat(r.baseUrl,"/cards/likes/").concat(e),{headers:r.headers,method:"DELETE"}).then((function(e){return e}))};function l(e){"Escape"===e.code&&m()}function s(e){e.stopPropagation()}function d(e){e.classList.remove("popup_opened"),e.querySelector(".popup__container").removeEventListener("click",s),e.removeEventListener("click",m),window.removeEventListener("keyup",l)}function f(e){e.classList.add("popup_opened"),e.querySelector(".popup__container").addEventListener("click",s),e.addEventListener("click",m),window.addEventListener("keyup",l)}function m(){var e;(e=document.querySelectorAll(".popup_opened"),Array.from(e)).forEach((function(e){d(e)}))}var p=document.querySelector(".popup__figure"),v=p.querySelector(".popup__figure-image"),_=p.querySelector(".popup__figure-caption"),y=document.querySelector("#card");function h(e,t,n,o,r){var l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],d=y.content.cloneNode(!0).querySelector("div"),m=d.querySelector(".elements__item-title");m.title=e,m.textContent=e;var p=d.querySelector(".elements__image");p.alt=e,p.src=t,p.addEventListener("click",(function(){!function(e,t){_.textContent=e,v.alt=e,v.src=t}(e,t),f(n)}));var h=d.querySelector(".elements__favorite-counter");h.textContent=l.length;var L=d.querySelector(".elements__favorite-button"),E="elements__favorite-button_active";b(l,r)?S(L,E):q(L,E),L.addEventListener("click",(function(){return function(e,t,n,o,r){c().then((function(c){b(c.find((function(e){return e._id===r})).likes,o)?a(r).then((function(o){!function(e,t){e.textContent=t.likes.length}(t,o),q(e,n)})):i(r).then((function(o){!function(e,t){e.textContent=t.likes.length}(t,o),S(e,n)}))})).catch((function(e){console.log(e)}))}(L,h,E,r,o)}));var g=d.querySelector(".elements__remove-button");return s?g.addEventListener("click",(function(e){return function(e,t){e.stopPropagation(),u(t).then((function(t){t&&e.target.closest(".elements__item").remove()})).catch((function(e){console.log(e)}))}(e,o)})):g.classList.add("elements__remove-button_inactive"),d}function b(e,t){return-1!==e.findIndex((function(e){return e._id===t}))}function S(e,t){e.classList.add(t)}function q(e,t){e.classList.remove(t)}var L=document.querySelector(".popup[data-type=create]"),E=document.querySelector(".popup[data-type=edit]"),g=document.querySelector(".popup[data-type=img]"),k=document.querySelector(".popup[data-type=avatar]"),C=L.querySelector(".form__submit-button"),x=document.querySelector(".profile__name"),U=document.querySelector("input[name=user-name"),A=document.querySelector(".profile__status"),w=document.querySelector("input[name=user-status"),P=document.querySelector(".profile__image"),T=document.querySelector("input[name=avatar-link]"),D=document.querySelector(".elements"),B=[];o("".concat(r.baseUrl,"/users/me"),{headers:r.headers}).then((function(e){return e})).then((function(e){x.textContent=e.name,A.textContent=e.about,P.src=e.avatar,B[0]=e._id,c().then((function(t){t.forEach((function(t){var n=e._id===t.owner._id,o=h(t.name,t.link,g,t._id,e._id,t.likes,n);D.append(o)}))})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}));var N=document.querySelector(".profile__button_move_edit"),O=document.querySelector(".popup__exit-button[data-type=edit]"),j=document.querySelector(".profile__button_move_add"),J=document.querySelector(".popup__exit-button[data-type=create]"),H=document.querySelector(".popup__exit-button[data-type=img]"),z=document.querySelector(".profile__image-wrapper"),I=document.querySelector(".popup__exit-button[data-type=avatar]");N.addEventListener("click",(function(){f(E),U.value=x.textContent,w.value=A.textContent})),O.addEventListener("click",(function(){return d(E)})),j.addEventListener("click",(function(){f(L),t(C,"form__submit-button_inactive")})),J.addEventListener("click",(function(){return d(L)})),H.addEventListener("click",(function(){return d(g)})),z.addEventListener("click",(function(){return f(k)})),I.addEventListener("click",(function(){return d(k)}));var M=document.querySelector("form[data-type=edit]");M.addEventListener("submit",(function(e){e.preventDefault(),oe(F),function(e){return o("".concat(r.baseUrl,"/users/me"),{headers:r.headers,method:"PATCH",body:JSON.stringify(e)}).then((function(e){return e}))}({name:U.value,about:w.value}).then((function(e){x.textContent=e.name,A.textContent=e.about,d(E)})).catch((function(e){console.log(e)})).finally((function(){re(F)}))}));var F=M.querySelector(".form__submit-button"),G=document.querySelector("input[name=place-name]"),K=document.querySelector("input[name=place-image]"),Q=document.querySelector("form[data-type=create]");Q.addEventListener("submit",(function(e){e.preventDefault(),oe(R),function(e){return o("".concat(r.baseUrl,"/cards"),{headers:r.headers,method:"POST",body:JSON.stringify(e)}).then((function(e){return e}))}({name:G.value,link:K.value}).then((function(e){var t=h(e.name,e.link,g,e._id,B[0]);D.prepend(t),Q.reset(),d(L)})).catch((function(e){console.log(e)})).finally((function(){re(R)}))}));var R=Q.querySelector(".form__submit-button"),V=document.querySelector("form[data-type=avatar]");V.addEventListener("submit",(function(e){e.preventDefault(),oe(ne),function(e){return o("".concat(r.baseUrl,"/users/me/avatar"),{headers:r.headers,method:"PATCH",body:JSON.stringify(e)}).then((function(e){return e}))}({avatar:T.value}).then((function(){P.src=T.value,d(k)})).catch((function(e){console.log(e)})).finally((function(){re(ne)}))}));var W,X,Y,Z,$,ee,te,ne=V.querySelector(".form__submit-button");function oe(e){e.disabled=!0,e.textContent="Сохранение...",e.classList.add("form__submit-button_inactive")}function re(e){e.disabled=!1,e.textContent="Сохранить",e.classList.remove("form__submit-button_inactive")}X=(W={formSelector:".form",inputSelector:".form__text-field",submitButtonSelector:".form__submit-button",inactiveButtonClass:"form__submit-button_inactive",inputErrorClass:"form__text-field_type_error",errorClass:"form__text-field-error_active"}).formSelector,Y=W.inputSelector,Z=W.submitButtonSelector,$=W.inactiveButtonClass,ee=W.inputErrorClass,te=W.errorClass,Array.from(document.querySelectorAll(X)).forEach((function(t){!function(t,n,o,r,c,u){var i=Array.from(t.querySelectorAll(n)),a=t.querySelector(o);e(i,a,r),a.addEventListener("click",(function(){return e(i,a,r)})),i.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n,o){t.validity.valid?function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),r.classList.remove(o),r.textContent=""}(e,t,n,o):function(e,t,n,o,r){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),c.textContent=n,c.classList.add(r)}(e,t,t.validationMessage,n,o)}(t,n,c,u),e(i,a,r)}))}))}(t,Y,Z,$,ee,te)}))})();